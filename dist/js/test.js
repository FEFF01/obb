!function(n,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e=t();for(var r in e)("object"==typeof exports?exports:n)[r]=e[r]}}(window,(function(){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=1)}([function(n,t,e){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),o=0;for(t=0;t<e;t++)for(var a=arguments[t],i=0,u=a.length;i<u;i++,o++)r[o]=a[i];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.reaction=t.watch=t.computed=t.runInSandbox=t.sandbox=t.runInAction=t.action=t.runInAtom=t.atom=t.autorun=t.observable=t.Subscriber=t.Observer=void 0;var a=[],i=[],u=[],c=[],s=new WeakMap,f=[],l=["iterate"],h=["undefined"],d=function(){function n(n){var t=this;this.target=n,this.refmap=new Map,this.ownmap=new Map,this._has=function(n){return n in t.target},this._val=function(n){return t.target[n]},this._del=function(n){return delete t.target[n]},this._set=function(n,e){return t.target[n]=e},this._proxy_handler={get:function(n,e){var r=n[e];return"__proto__"!==e&&(r=_(r),t.collect(e)),r},set:function(n,e,r){var o=n[e],a=s.get(r),i=a?a.target:r,u=n.hasOwnProperty(e),c=O(o,i);return c&&u||(n[e]=i),u||(t.notify(e,!1,1),t.notify(l,l,1)),c||t.notify(e,o),!0},ownKeys:function(n){return t.collect(l,1),v(n)},has:function(n,e){return t.collect(e,1),e in n},deleteProperty:function(n,e){return g((function(){return n.hasOwnProperty(e)&&(t.notify(e,n[e]),t.notify(e,!0,1),t.notify(l,l,1)),delete n[e]}))}};var e=s.get(n);if(e)return e;switch(!0){case n instanceof WeakSet:case n instanceof WeakMap:case n instanceof Map:case n instanceof Set:S(this);break;case n[Symbol.iterator]:case n instanceof Array:!function(n){var t=n.target,e=t.__proto__,r=n._proxy_handler.set;t.__proto__=Object.create(e,Array.prototype.concat.call(["push","pop","shift","unshift","splice","sort","reverse"].map((function(n){var t=e[n];return t&&[n,function(){var n=this,e=arguments;return g((function(){return t.apply(n,e)}))}]})),["values",Symbol.iterator].map((function(r){var o=e[r];return o&&[r,function(){return n.collect(l,1),A(o.call(t))}]}))).reduce((function(n,t){return t&&(n[t[0]]={value:t[1]}),n}),{})),n._proxy_handler.set=function(e,o,a){var i=t.length;return g((function(){var u=r(e,o,a);return t.length!==i&&n.notify("length",i,10),u}))}}(this)}this.proxy=new Proxy(n,this._proxy_handler),s.set(this.proxy,this),s.set(n,this)}return n.prototype.collect=function(n,t){void 0===t&&(t=2);var e=a[0];if(e&&!e.disabled){var r=this._map(t),o=r.get(n);o||r.set(n,o=new Set),e.depend(o)}},n.prototype.release=function(){for(var n=0,t=[this.refmap,this.ownmap];n<t.length;n++){var e=t[n];e.forEach((function(n){n.forEach((function(t){return t.undepend(n)}))})),e.clear()}},n.prototype.notify=function(n,t,e){void 0===e&&(e=2);var r=[this,n,t,e];f.length&&f[0][0].push(r);var o=this._map(e).get(n);o&&o.size&&w(Array.from(o),c.length&&r)},n.prototype._map=function(n){return 2&n?this.refmap:this.ownmap},n}();t.Observer=d;var p=function(){function n(n){this.fn=n,this.children=[],this._deps=new Set,this.is_run=!1}return n.prototype.undepend=function(n){this._deps.delete(n),n.delete(this)},n.prototype.depend=function(n){this._deps.add(n),n.add(this)},n.prototype.clear=function(n){var t=this;if(this._deps.forEach((function(n){return n.delete(t)})),this._deps.clear(),!n)for(var e=0,r=this.children;e<r.length;e++){var o=r[e];o.clear(),o.parent=void 0}this.children.length=0},n.prototype.unmount=function(n){var t;if(this.clear(n),!n){var e=null===(t=this.parent)||void 0===t?void 0:t.children;if(e&&e.splice(e.indexOf(this),1),this._sandbox){var r=this._sandbox[1].indexOf(this);r>=0&&this._sandbox[1].splice(r,1)}}this._sandbox=void 0,this.parent=void 0},n.prototype.mount=function(){return void 0!==this.parent?new n(this.fn).mount():(f.length&&(this._sandbox=f[0],this._sandbox[1].push(this)),this.parent=a[0]||null,this.parent&&this.parent.children.push(this),this._run(),this)},n.prototype.update=function(){return this.clear(),this._run()},n.prototype.addRecord=function(n){var t=c[0][0],e=u.indexOf(this);e<0||i[e][0]<t?(i.unshift([t,[n]]),u.unshift(this)):i[e][1].push(n)},n.prototype._run=function(){this.is_run=!0,a.unshift(this);try{return this.fn()}catch(n){throw n}finally{a.shift(),this.is_run=!1}},n}();function v(n){return Array.prototype.concat.call(Object.getOwnPropertySymbols(n),Object.getOwnPropertyNames(n))}function y(n,t){!function(n){var t=c[0],e=void 0===n&&t?1&t[1]:n?1:0;c.unshift([n&&t?t[0]:c.length,e])}(t);try{return n()}catch(n){throw n}finally{!function(){var n=[],t=c.shift(),e=t[0];if(1&t[1]&&0!==c.length)return;for(;u.length&&i[0][0]>=e;){var r=u.shift(),o=i.shift();if(n.indexOf(r)<0&&x(o[1])){for(var a=void 0;(a=u.lastIndexOf(r))>=0;)u.splice(a,1),i.splice(a,1);n.unshift(r)}}w(n)}()}}function g(n){return y(n,!0)}function b(n,t){void 0===t&&(t=7);var e=f[0],r=a[0],o=r&&r.disabled,i=4&t||!e?[]:e[1],u=i.length,c=4&t||!e?[]:e[0];r&&(r.disabled=1&t),f.unshift([c,i,t]);try{return n()}catch(n){throw n}finally{if(f.shift(),4&t&&function(n){var t=[];x(n,(function(n){var e=n[0],r=n[1],o=n[3];if(1&o)e._del(r);else if(4&~o){if(8&o)return void t.push(n);e._set(r,n[2])}}));for(var e=0,r=t;e<r.length;e++){var o=r[e];o[0]._set(o[1],o[2])}}(c),2&t){for(var s=i.length-1;s>=u;s--){var l=i[s];l.unmount(l.parent!==r)}i.length=u}else e&&4&t&&Array.prototype.push.apply(e[1],i);r&&(r.disabled=o)}}function _(n){return n&&"object"==typeof n?new d(n).proxy:n}function m(n,t){var e=[],r=new p((function(){e.unshift(n()),e.length>1&&(t(e[0],e[1]),e.length=1)}));return r.mount(),function(){r.unmount()}}function x(n,t){for(var e=new Map,r=!1,o=0,a=n;o<a.length;o++){var i=a[o],u=i[0],c=i[1],s=e.get(u);if(s){if(s.has(c))continue;s.add(c)}else e.set(u,new Set([c]));if(!O(1!==i[3]?u._val(c):u._has(c),i[2])){if(!t)return!0;-1===t(i)&&s.delete(c),r=!0}}return r}function w(n,t){var e=[],r=f[0],o=r&&4&r[2]&&r[1];n:for(var a=0,i=void 0;a<n.length;a++){for(i=n[a];i=i.parent;)if(n.indexOf(i)>=0){n.splice(a--,1);continue n}(i=n[a]).is_run||o&&o.indexOf(i)<0||e.push(n[a])}e.forEach(t?function(n){return n.addRecord(t)}:function(n){return n.update()})}function O(n,t){return n===t||n!=n&&t!=t}function S(n){var t,e=n.target,a=e.__proto__,i=new d({}),u=(null===(t=Object.getOwnPropertyDescriptor(a,"size"))||void 0===t?void 0:t.get.bind(e))||function(){};n.release=function(){return i.release(),n.release()},i._has=a.has.bind(e),i._val=e instanceof Map||e instanceof WeakMap?function(n){return a.get.call(e,n)}:function(n){return a.has.call(e,n)?n:h},i._del=function(n){return a.delete.call(e,n)},i._set=a.set?function(n,t){return a.set.call(e,n,t)}:function(n,t){return a.add.call(e,n)};for(var c=r({get:function(n){return i.collect(n),_(a.get.call(e,n))},set:function(n,t){var r=a.has.call(e,n),o=r?a.get.call(e,n):void 0;return a.set.call(e,n,t),r||i.notify(n,!1,1),i.notify(n,o),this},add:function(t){return a.has.call(e,t)||g((function(){var r=u();a.add.call(e,t),void 0!==r&&n.notify("size",r,6),i.notify(t,!1,1),i.notify(t,h),i.notify(l,l,1)})),this},delete:function(t){var r=a.get,o=r?r.call(e,t):t,c=u(),s=a.delete.call(e,t);return s&&g((function(){i.notify(t,o),i.notify(t,!0,1),i.notify(l,l,1),void 0!==c&&n.notify("size",c,6)})),s},clear:function(){var t=u();t&&g((function(){a.forEach.call(e,(function(n,t){i.notify(t,n),i.notify(t,!0,1)})),i.notify(l,l,1),n.notify("size",t,6),a.clear.call(e)}))},forEach:function(n){for(var t,r=[],u=1;u<arguments.length;u++)r[u-1]=arguments[u];return i.collect(l,1),(t=a.forEach).call.apply(t,o([e,function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];n.apply(void 0,o([_(t)],e))}],r))},has:function(n){return i.collect(n,1),a.has.call(e,n)},size:u},["keys","entries","values",Symbol.iterator].reduce((function(n,t){var r=a[t];return r&&(n[t]=function(){return i.collect(l,1),A(r.apply(e,arguments))}),n}),{})),s={},f=0,p=v(a);f<p.length;f++){var y=p[f],b=c[y],m=Object.getOwnPropertyDescriptor(a,y);b&&(void 0!==m.value?m.value=b:m.get=b),s[y]=m}e.__proto__=Object.create(e.__proto__.__proto__,s)}function A(n){var t=n.next.bind(n);return n.next=function(){var n=t(),e=n.done,r=n.value;return e||(r=_(r)),{done:e,value:r}},n}t.Subscriber=p,t.atom=function(n){return y.bind(null,n,!0)},t.runInAtom=g,t.action=function(n){return y.bind(null,n)},t.runInAction=function(n){return y(n)},t.sandbox=function(n){return b.bind(null,n)},t.runInSandbox=b,t.autorun=function(n){var t=new p(n);return t.mount(),function(){t.unmount()}},t.observable=_,t.computed=function(n){var t,e=0,r=new p((function(){(e^=1)&&(t=n())}));return function(){return e||r.update(),t}},t.watch=m,t.reaction=function(n,t){return m(n,(function(n,e){O(n,e)||t(n)}))}},function(n,t,e){"use strict";var r,o=this&&this.__spreadArrays||function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),o=0;for(t=0;t<e;t++)for(var a=arguments[t],i=0,u=a.length;i<u;i++,o++)r[o]=a[i];return r};Object.defineProperty(t,"__esModule",{value:!0});var a=e(0),i=a.observable([{a:1},2,3]),u=a.observable(((r={a:[1],b:2,c:3})[Symbol("test")]=4,r)),c=a.observable(new Set([1,2,3])),s=a.observable(new Map([["a",[1]],["b",2],["c",3]])),f=a.observable(new WeakSet),l=a.observable(new WeakMap),h=a.observable(new Float32Array(10));function d(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];t.length&&t.unshift("->"),console.log.apply(console,o([n],t))}a.autorun((function(){console.log(111,s.get("a")),a.autorun((function(){console.log(111,s.keys());for(var n=function(n){a.autorun((function(){var t=s.get(n);console.log(111,n,t,t instanceof Array&&t[0])}))},t=0,e=Array.from(s.keys());t<e.length;t++){n(e[t])}}))})),d("-------------"),a.runInSandbox((function(){console.log(s),a.autorun((function(){console.log(s.get("a")),a.autorun((function(){console.log(s.keys());for(var n=function(n){a.autorun((function(){var t=s.get(n);console.log(n,t,t instanceof Array&&t[0])}))},t=0,e=Array.from(s.keys());t<e.length;t++)n(e[t])}))})),d("-------------",'map.get("a")[0] = 2'),s.get("a")[0]=2,d("-------------",'map.set("a", [3]);'),s.set("a",[3]),d("-------------",'map.set("b", [4]);'),s.set("b",[4]),d("-------------"),a.autorun((function(){d("array[Symbol.iterator]().next().value",i[Symbol.iterator]().next())})),a.autorun((function(){d(" array.indexOf(2)",i.indexOf(2))})),a.autorun((function(){d("array.values()",i.values())})),a.autorun((function(){d("array[0].a",i[0].a)})),a.autorun((function(){d("array.length",i.length)})),i.unshift(i[0]),i.unshift({a:1.1}),a.runInAtom((function(){a.runInAction((function(){i.unshift({a:0})})),i.shift()})),i[0].a=1.2,a.autorun((function(){d("array[1], json.a[0]",i[1],u.a[0])})),a.autorun((function(){d("array[3]",i[3])})),a.runInAction((function(){console.log("runInAction1","==========="),i[1]={a:1.3},a.runInAction((function(){console.log("runInAction2","==========="),i[1]={a:1.4},u.a[0]+=.1})),console.log("runInAction3","==========="),i[3]+=.1})),console.log("runInAction4","==========="),console.log("array","->",JSON.stringify(i)),d("------------------"),a.autorun((function(){d("weakset.a",f.a)})),a.autorun((function(){d('"a" in weakset',"a"in f)})),f.a=3,delete f.a,a.autorun((function(){d("weakset.has(f32arr)",f.has(h))})),f.add(h),f.delete(h),a.autorun((function(){d(l,l.get(h))})),l.set(h,33),l.delete(h),d(c[Symbol.toStringTag]),a.autorun((function(){d(Object.keys(u))})),u.d=2,delete u.d,a.autorun((function(){d('"2" in array',"2"in i)})),d("3333",u.d),a.autorun((function(){d("set.size",c.size)})),a.autorun((function(){d("set.has(2)",c.has(2))})),a.autorun((function(){d("set.has(4)",c.has(4))})),d("---------------------set.add(4);"),c.add(4),d("---------------------set.delete(2);"),c.delete(2),d("---------------------set.clear()"),c.clear(),d("---------------------")})),console.log(i,u,c,s,f,l,h),d("-------------",'map.set("a", [3]);'),s.set("a",[3]),d("-------------",'map.set("b", [4]);'),s.set("b",[4]),d("-------------"),d("-------------",'map.get("a")[0] = 3'),s.get("a")[0]=4,a.autorun((function(){a.runInSandbox((function(){console.log("Sandbox",s.get("b")),a.runInSandbox((function(){console.log("NORMAL",s.get("a"))}),0)}))})),d("-------------",'map.set("a", [5]);'),s.set("a",[5]),d("-------------",'map.set("b", [6]);'),s.set("b",[6]),a.runInSandbox((function(){a.autorun((function(){console.log("1111",s.get("a")),a.runInSandbox((function(){console.log("222",s.get("b")),a.runInSandbox((function(){console.log("333",s.get("c"))}),2)}))})),s.set("a",[333]),a.runInSandbox((function(){s.set("a",[444])}),0),a.runInSandbox((function(){s.set("a",[555])})),s.set("c",["cccccccccc"])})),s.set("a",[666])}])}));
//# sourceMappingURL=test.js.map