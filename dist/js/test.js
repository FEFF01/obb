!function(n,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e=t();for(var r in e)("object"==typeof exports?exports:n)[r]=e[r]}}(window,(function(){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}return e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=2)}([function(n,t,e){"use strict";(function(n){var e,r=this&&this.__assign||function(){return(r=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),o=0;for(t=0;t<e;t++)for(var a=arguments[t],i=0,u=a.length;i<u;i++,o++)r[o]=a[i];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.reaction=t.watch=t.computed=t.SANDOBX_OPTION=t.runInSandbox=t.sandbox=t.runInAction=t.action=t.runInAtom=t.atom=t.autorun=t.observable=t.Subscriber=t.Observer=void 0,function(n){n[n.PREVENT_COLLECT=1]="PREVENT_COLLECT",n[n.CLEAN_SUBSCRIBE=2]="CLEAN_SUBSCRIBE",n[n.CLEAN_CHANGE=4]="CLEAN_CHANGE",n[n.DEFAULT=7]="DEFAULT",n[n.NORMAL=0]="NORMAL"}(e||(e={})),t.SANDOBX_OPTION=e;var a="object"==typeof window?window:n,i=[],u=[],c=[],s=[],f=new WeakMap,l=[],h=["iterate"],p=["undefined"],d=function(){function n(n){var t=this;switch(this.target=n,this.refmap=new Map,this.ownmap=new Map,this._has=function(n){return n in t.target},this._val=function(n){return t.target[n]},this._del=function(n){return delete t.target[n]},this._set=function(n,e){return t.target[n]=e},this._proxy_handler={get:function(n,e){var r=n[e];return"__proto__"!==e&&(r=O(r),t.collect(e)),r},set:function(n,e,r){var o=n[e],a=f.get(r),i=a?a.target:r,u=n.hasOwnProperty(e),c=w(o,i);return c&&u||(n[e]=i),u||(t.notify(e,!1,1),t.notify(h,h,1)),c||t.notify(e,o),!0},ownKeys:function(n){return t.collect(h,1),y(n)},has:function(n,e){return t.collect(e,1),e in n},deleteProperty:function(n,e){return _((function(){return n.hasOwnProperty(e)&&(t.notify(e,n[e]),t.notify(e,!0,1),t.notify(h,h,1)),delete n[e]}))}},!0){case n instanceof WeakSet:case n instanceof WeakMap:case n instanceof Map:case n instanceof Set:N(this);break;case n[Symbol.iterator]:case n instanceof Array:!function(n){var t=n.target,e=t.__proto__,r=n._proxy_handler.set;t.__proto__=Object.create(e,Array.prototype.concat.call(["push","pop","shift","unshift","splice","sort","reverse"].map((function(n){var t=e[n];return t&&[n,function(){var n=this,e=arguments;return _((function(){return t.apply(n,e)}))}]})),["values",Symbol.iterator].map((function(r){return e[r]&&[r,function(){n.collect(h,1);var e=0,r=n.proxy;return{next:function(){var n,o=e>=t.length;return o||(n=r[e++]),{done:o,value:n}}}}]}))).reduce((function(n,t){return t&&(n[t[0]]={value:t[1]}),n}),{})),n._proxy_handler.set=function(e,o,a){var i=t.length;return _((function(){var u=r(e,o,a);return t.length!==i&&n.notify("length",i,10),u}))}}(this)}this.proxy=new Proxy(n,this._proxy_handler),f.set(this.proxy,this),f.set(n,this)}return n.prototype.collect=function(n,t){void 0===t&&(t=2);var e=i[0];if(e&&!e.passive){var r=this._map(t),o=r.get(n);o||r.set(n,o=new Set),e.depend(o)}},n.prototype.release=function(){for(var n=0,t=[this.refmap,this.ownmap];n<t.length;n++){var e=t[n];e.forEach((function(n){n.forEach((function(t){return t.undepend(n)}))})),e.clear()}},n.prototype.notify=function(n,t,e){void 0===e&&(e=2);var r=[this,n,t,e];l.length&&l[0][0].push(r);var o=this._map(e).get(n);o&&o.size&&x(Array.from(o),s.length&&r)},n.prototype._map=function(n){return 2&n?this.refmap:this.ownmap},n}();t.Observer=d;var v=function(){function n(n,t){this.fn=n,this.passive=t,this.children=[],this._deps=new Set,this.is_run=!1}return n.prototype.undepend=function(n){this._deps.delete(n),n.delete(this)},n.prototype.depend=function(n){this._deps.add(n),n.add(this)},n.prototype.clear=function(n){var t=this;if(this._deps.forEach((function(n){return n.delete(t)})),this._deps.clear(),!n)for(var e=0,r=this.children;e<r.length;e++){var o=r[e];o.clear(),o.parent=void 0}this.children.length=0},n.prototype.unmount=function(n){var t;if(this.clear(n),!n){var e=null===(t=this.parent)||void 0===t?void 0:t.children;if(e&&e.splice(e.indexOf(this),1),this._sandbox){var r=this._sandbox[1].indexOf(this);r>=0&&this._sandbox[1].splice(r,1)}}this._sandbox=void 0,this.parent=void 0},n.prototype.mount=function(t){return void 0!==this.parent?new n(this.fn).mount(t):(l.length&&(this._sandbox=l[0],this._sandbox[1].push(this)),this.parent=t||i[0]||null,this.parent&&this.parent.children.push(this),this._run(),this)},n.prototype.update=function(){return this.clear(),this._run()},n.prototype.addRecord=function(n){var t=s[0][0],e=c.indexOf(this);e<0||u[e][0]<t?(u.unshift([t,[n]]),c.unshift(this)):u[e][1].push(n)},n.prototype._run=function(){this.is_run=!0,i.unshift(this);try{return this.res=this.fn()}catch(n){throw n}finally{i.shift(),this.is_run=!1}},n}();function y(n){return Array.prototype.concat.call(Object.getOwnPropertySymbols(n),Object.getOwnPropertyNames(n))}function g(n,t){!function(n){var t=s[0],e=void 0===n&&t?1&t[1]:n?1:0;s.unshift([n&&t?t[0]:s.length,e])}(t);try{return n()}catch(n){throw n}finally{!function(){var n=[],t=s.shift(),e=t[0];if(1&t[1]&&0!==s.length)return;for(;c.length&&u[0][0]>=e;){var r=c.shift(),o=u.shift();if(n.indexOf(r)<0&&m(o[1])){for(var a=void 0;(a=c.lastIndexOf(r))>=0;)c.splice(a,1),u.splice(a,1);n.unshift(r)}}x(n)}()}}function _(n){return g(n,!0)}function b(n,t){void 0===t&&(t=e.DEFAULT);var r=l[0],o=i[0],a=o&&o.passive,u=t&e.CLEAN_CHANGE||!r?[]:r[1],c=u.length,s=t&e.CLEAN_CHANGE||!r?[]:r[0];o&&(o.passive=t&e.PREVENT_COLLECT),l.unshift([s,u,t|(r&&r[2]&e.CLEAN_CHANGE)]);try{return n()}catch(n){throw n}finally{if(l.shift(),t&e.CLEAN_CHANGE&&function(n){var t=[];m(n,(function(n){var e=n[0],r=n[1],o=n[3];if(1&o)e._del(r);else if(4&~o){if(8&o)return void t.push(n);e._set(r,n[2])}}));for(var e=0,r=t;e<r.length;e++){var o=r[e];o[0]._set(o[1],o[2])}}(s),t&e.CLEAN_SUBSCRIBE){for(var f=u.length-1;f>=c;f--){var h=u[f];h.unmount(h.parent!==o)}u.length=c}else r&&t&e.CLEAN_CHANGE&&Array.prototype.push.apply(r[1],u);o&&(o.passive=a)}}t.Subscriber=v,t.atom=function(n){return g.bind(null,n,!0)},t.runInAtom=_,t.action=function(n){return g.bind(null,n)},t.runInAction=function(n){return g(n)},t.sandbox=function(n){return b.bind(null,n)},t.runInSandbox=b,t.autorun=function(n,t){void 0===t&&(t=!1);var e=new v(n,t);return e.mount(),function(){e.unmount()}};var A=new Set([Object,Array,Map,Set,WeakMap,WeakSet,Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray]);function O(n){if(n&&"object"==typeof n){var t=f.get(n);if(t)n=t.proxy;else{var e=n.constructor;(A.has(e)||a[e.name]!==e)&&(n=new d(n).proxy)}}return n}function S(n,t){var e=[],r=new v((function(){e.unshift(n()),e.length>1&&(t(e[0],e[1]),e.length=1)}));return r.mount(),function(){r.unmount()}}function m(n,t){for(var e=new Map,r=!1,o=0,a=n;o<a.length;o++){var i=a[o],u=i[0],c=i[1],s=e.get(u);if(s){if(s.has(c))continue;s.add(c)}else e.set(u,new Set([c]));if(!w(1!==i[3]?u._val(c):u._has(c),i[2])){if(!t)return!0;-1===t(i)&&s.delete(c),r=!0}}return r}function x(n,t){var r=l[0],o=r&&r[2]&e.CLEAN_CHANGE&&r[1];function a(n){return!o||o.indexOf(n)>=0}n:for(var i=0;i<n.length;i++){for(var u=n[i];(u=u.parent)&&!u.is_run&&a(u);)if(n.indexOf(u)>=0){n.splice(i--,1);continue n}!(u=n[i]).is_run&&a(u)||n.splice(i--,1)}n.forEach(t?function(n){return n.addRecord(t)}:function(n){void 0!==n.parent&&n.update()})}function w(n,t){return n===t||n!=n&&t!=t}function N(n){var t,e=n.target,a=e.__proto__,i=new d({}),u=(null===(t=Object.getOwnPropertyDescriptor(a,"size"))||void 0===t?void 0:t.get.bind(e))||function(){};n.release=function(){return i.release(),n.release()},i._has=a.has.bind(e),e instanceof Map||e instanceof WeakMap?i._val=function(n){return a.get.call(e,n)}:i._val=function(n){return a.has.call(e,n)?n:p},i._del=function(n){return a.delete.call(e,n)},i._set=a.set?function(n,t){return a.set.call(e,n,t)}:function(n,t){return a.add.call(e,n)};for(var c=r({get:function(n){return i.collect(n),O(a.get.call(e,n))},set:function(n,t){var r=f.get(n);r&&(n=r.target);var o=a.has.call(e,n),u=o?a.get.call(e,n):void 0;return a.set.call(e,n,t),o||i.notify(n,!1,1),i.notify(n,u),this},add:function(t){return a.has.call(e,t)||_((function(){var r=u();a.add.call(e,t),void 0!==r&&n.notify("size",r,6),i.notify(t,!1,1),i.notify(t,p),i.notify(h,h,1)})),this},delete:function(t){var r=a.get,o=r?r.call(e,t):t,c=u(),s=a.delete.call(e,t);return s&&_((function(){i.notify(t,o),i.notify(t,!0,1),i.notify(h,h,1),void 0!==c&&n.notify("size",c,6)})),s},clear:function(){var t=u();t&&_((function(){a.forEach.call(e,(function(n,t){i.notify(t,n),i.notify(t,!0,1)})),i.notify(h,h,1),n.notify("size",t,6),a.clear.call(e)}))},forEach:function(n){for(var t,r=[],u=1;u<arguments.length;u++)r[u-1]=arguments[u];return i.collect(h,1),(t=a.forEach).call.apply(t,o([e,function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];n.apply(void 0,o([O(t)],e))}],r))},has:function(n){return i.collect(n,1),a.has.call(e,n)},size:u},[["keys",function(n){return n[0]}],["entries",function(n){return[n[0],O(n[1])]}],["values",function(n){return O(n[1])}],[Symbol.iterator,function(n){return O(n[1])}]].reduce((function(n,t){var r=t[0],o=t[1],u=a.entries;return u&&(n[r]=function(){i.collect(h,1);var n=u.call(e),t=n.next.bind(n);return n.next=function(){var n=t(),e=n.done,r=n.value;return e||(i.collect(r[0]),i.collect(r[0],1),r=o(r)),{done:e,value:r}},n}),n}),{})),s={},l=0,v=y(a);l<v.length;l++){var g=v[l],b=c[g],A=Object.getOwnPropertyDescriptor(a,g);b&&(void 0!==A.value?A.value=b:A.get=b),s[g]=A}e.__proto__=Object.create(e.__proto__.__proto__,s)}t.observable=O,t.computed=function(n){var t,e=0,r=new v((function(){(e^=1)&&(t=n())}));return function(){return e||r.update(),t}},t.watch=S,t.reaction=function(n,t){return S(n,(function(n,e){w(n,e)||t(n)}))}}).call(this,e(1))},function(n,t){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(n){"object"==typeof window&&(e=window)}n.exports=e},function(n,t,e){"use strict";var r,o=this&&this.__spreadArrays||function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),o=0;for(t=0;t<e;t++)for(var a=arguments[t],i=0,u=a.length;i<u;i++,o++)r[o]=a[i];return r};Object.defineProperty(t,"__esModule",{value:!0});var a=e(0),i=a.observable([{a:1},2,3]),u=a.observable(((r={a:[1],b:2,c:3})[Symbol("test")]=4,r)),c=a.observable(new Set([1,2,3])),s=a.observable(new Map([["a",[1]],["b",2],["c",3]])),f=a.observable(new WeakSet),l=a.observable(new WeakMap),h=a.observable(new Float32Array(10));function p(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];t.length&&t.unshift("->"),console.log.apply(console,o([n],t))}console.log(""+a.observable(new Date));var d=a.observable([1,2,3]);a.runInSandbox((function(){a.autorun((function(){console.log("a[0]",d[0])})),d.unshift(111),a.runInSandbox((function(){d.unshift(222),a.autorun((function(){console.log("a[1]",d[1])})),d.unshift(333)})),console.log("JSON.stringify(a)",JSON.stringify(d)),a.runInAction((function(){d.unshift(1,2,3),d.splice(0,3)})),a.runInAction((function(){d[0]+=1,d[0]+=1})),a.autorun((function(){a.runInSandbox((function(){console.log("a[1]",d[1]),a.runInSandbox((function(){console.log("a[2]",d[2])}),a.SANDOBX_OPTION.NORMAL)}),a.SANDOBX_OPTION.PREVENT_COLLECT)})),d[1]+=1,console.log("-----------------"),d[2]+=1})),console.log("================="),console.log("JSON.stringify(a)",JSON.stringify(d)),a.autorun((function(){console.log("000000001111",s.get("a"))})),a.runInSandbox((function(){a.autorun((function(){console.log("1111",s.get("a")),a.runInSandbox((function(){console.log("222",s.get("b")),a.runInSandbox((function(){console.log("333",s.get("c"))}),a.SANDOBX_OPTION.CLEAN_SUBSCRIBE)}))})),s.set("a",[333]),a.runInSandbox((function(){s.set("a",[444])}),a.SANDOBX_OPTION.NORMAL),a.runInSandbox((function(){s.set("a",[555])})),s.set("c",["cccccccccc"])})),s.set("a",[666]),a.autorun((function(){console.log(111,s.get("a")),a.autorun((function(){console.log(111,s.keys());for(var n=function(n){a.autorun((function(){var t=s.get(n);console.log(111,n,t,t instanceof Array&&t[0])}))},t=0,e=Array.from(s.keys());t<e.length;t++){n(e[t])}}))})),p("-------------"),a.runInSandbox((function(){console.log(s),a.autorun((function(){console.log(s.get("a")),a.autorun((function(){console.log(s.keys());for(var n=function(n){a.autorun((function(){var t=s.get(n);console.log(n,t,t instanceof Array&&t[0])}))},t=0,e=Array.from(s.keys());t<e.length;t++)n(e[t])}))})),p("-------------",'map.get("a")[0] = 2'),s.get("a")[0]=2,p("-------------",'map.set("a", [3]);'),s.set("a",[3]),p("-------------",'map.set("b", [4]);'),s.set("b",[4]),p("-------------"),a.autorun((function(){p("array[Symbol.iterator]().next().value",i[Symbol.iterator]().next())})),a.autorun((function(){p(" array.indexOf(2)",i.indexOf(2))})),a.autorun((function(){p("array.values()",i.values())})),a.autorun((function(){p("array[0].a",i[0].a)})),a.autorun((function(){p("array.length",i.length)})),i.unshift(i[0]),i.unshift({a:1.1}),a.runInAtom((function(){a.runInAction((function(){i.unshift({a:0})})),i.shift()})),i[0].a=1.2,a.autorun((function(){p("array[1], json.a[0]",i[1],u.a[0])})),a.autorun((function(){p("array[3]",i[3])})),a.runInAction((function(){console.log("runInAction1","==========="),i[1]={a:1.3},a.runInAction((function(){console.log("runInAction2","==========="),i[1]={a:1.4},u.a[0]+=.1})),console.log("runInAction3","==========="),i[3]+=.1})),console.log("runInAction4","==========="),console.log("array","->",JSON.stringify(i)),p("------------------"),a.autorun((function(){p("weakset.a",f.a)})),a.autorun((function(){p('"a" in weakset',"a"in f)})),f.a=3,delete f.a,a.autorun((function(){p("weakset.has(f32arr)",f.has(h))})),f.add(h),f.delete(h),a.autorun((function(){p(l,l.get(h))})),l.set(h,33),l.delete(h),p(c[Symbol.toStringTag]),a.autorun((function(){p(Object.keys(u))})),u.d=2,delete u.d,a.autorun((function(){p('"2" in array',"2"in i)})),p("3333",u.d),a.autorun((function(){p("set.size",c.size)})),a.autorun((function(){p("set.has(2)",c.has(2))})),a.autorun((function(){p("set.has(4)",c.has(4))})),p("---------------------set.add(4);"),c.add(4),p("---------------------set.delete(2);"),c.delete(2),p("---------------------set.clear()"),c.clear(),p("---------------------")})),console.log(i,u,c,s,f,l,h),p("-------------",'map.set("a", [3]);'),s.set("a",[3]),p("-------------",'map.set("b", [4]);'),s.set("b",[4]),p("-------------"),p("-------------",'map.get("a")[0] = 3'),s.get("a")[0]=4,a.autorun((function(){a.runInSandbox((function(){console.log("Sandbox",s.get("b")),a.runInSandbox((function(){console.log("NORMAL",s.get("a"))}),a.SANDOBX_OPTION.NORMAL)}))})),p("-------------",'map.set("a", [5]);'),s.set("a",[5]),p("-------------",'map.set("b", [6]);'),s.set("b",[6])}])}));
//# sourceMappingURL=test.js.map