!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.reaction=e.watch=e.computed=e.runAction=e.action=e.runAtomic=e.atomic=e.autorun=e.observable=e.Subscriber=e.Observer=void 0;const r=[],o=[],i=[],a=[],l=new WeakMap,s=["iterate"],u=["undefined"];class c{constructor(t){this.target=t,this.refmap=new Map,this.ownmap=new Map,this._has=t=>t in this.target,this._val=t=>this.target[t],this._proxy_handler={get:(t,e)=>{let n=t[e];return"__proto__"!==e&&(n=y(n),this.collect(e)),n},set:(t,e,n)=>{let r=t[e],o=l.get(n),i=o?o.target:n,a=t.hasOwnProperty(e),u=g(r,i);return u&&a||(t[e]=i),u||this.notify(e,r),a||(this.notify(e,!1,1),this.notify(s,s,1)),!0},ownKeys:t=>(this.collect(s,1),h(t)),has:(t,e)=>(this.collect(e,1),e in t),deleteProperty:(t,e)=>p(()=>(t.hasOwnProperty(e)&&(this.notify(e,t[e]),this.notify(e,!0,1),this.notify(s,s,1)),delete t[e]))};let e=l.get(t);if(e)return e;switch(!0){case t instanceof WeakSet:case t instanceof WeakMap:case t instanceof Map:case t instanceof Set:!function(t){var e;let n=t.target,r=n.__proto__,o=new c({}),i=(null===(e=Object.getOwnPropertyDescriptor(r,"size"))||void 0===e?void 0:e.get.bind(n))||function(){};t.release=function(){return o.release(),t.release()},o._has=r.has.bind(n),o._val=n instanceof Map||n instanceof WeakMap?function(t){return r.get.call(n,t)}:function(t){return r.has.call(n,t)?t:u};let a=Object.assign({get:t=>(o.collect(t),y(r.get.call(n,t))),set(t,e){let i=r.has.call(n,t),a=i?r.get.call(n,t):void 0;return r.set.call(n,t,e),o.notify(t,a),i||o.notify(t,!1,1),this},add(e){return r.has.call(n,e)||p(()=>{let a=i();r.add.call(n,e),void 0!==a&&t.notify("size",a),o.notify(e,u),o.notify(e,!1,1),o.notify(s,s,1)}),this},delete(e){let a=r.get,l=a?a.call(n,e):e,u=r.delete.call(n,e);return u&&p(()=>{let n=i();void 0!==n&&t.notify("size",n),o.notify(e,l),o.notify(e,!0,1),o.notify(s,s,1)}),u},clear(){let e=i();e&&p(()=>{r.forEach.call(n,(t,e)=>{o.notify(e,t),o.notify(e,!0,1)}),t.notify("size",e),o.notify(s,s,1),r.clear.call(n)})},forEach:(t,...e)=>(o.collect(s,1),r.forEach.call(n,(function(e,...n){t(y(e),...n)}),...e)),has:t=>(o.collect(t,1),r.has.call(n,t)),size:i},["keys","entries","values",Symbol.iterator].reduce((function(t,e){let i=r[e];return i&&(t[e]=function(){return o.collect(s,1),v(i.apply(n,arguments))}),t}),{})),l={},f=h(r);for(let t of f){let e=a[t],n=Object.getOwnPropertyDescriptor(r,t);e&&(void 0!==n.value?n.value=e:n.get=e),l[t]=n}n.__proto__=Object.create(n.__proto__.__proto__,l)}(this);break;case t[Symbol.iterator]:case t instanceof Array:!function(t){let e=t.target,n=e.__proto__,r=t._proxy_handler.set;e.__proto__=Object.create(n,Array.prototype.concat.call(["push","pop","shift","unshift","splice","sort","reverse"].map((function(t){const e=n[t];return e&&[t,function(){let t=arguments;return p(()=>e.apply(this,t))}]})),["values",Symbol.iterator].map((function(r){const o=n[r];return o&&[r,function(){return t.collect(s,1),v(o.call(e))}]}))).reduce((function(t,e){return e&&(t[e[0]]={value:e[1]}),t}),{})),t._proxy_handler.set=function(n,o,i){let a=e.length;return p((function(){let l=r(n,o,i);return e.length!==a&&t.notify("length",a),l}))}}(this)}this.proxy=new Proxy(t,this._proxy_handler),l.set(this.proxy,this),l.set(t,this)}collect(t,e){let n=r[0];if(n){let r=this._map(e),o=r.get(t);o||r.set(t,o=new Set),n.depend(o)}}release(){for(let t of[this.refmap,this.ownmap])t.forEach(t=>{t.forEach(e=>e.undepend(t))}),t.clear()}notify(t,e,n=2){if(null===a[0])return;let r=this._map(n).get(t);r&&r.size&&_(Array.from(r),a.length&&[this,t,e,n])}_map(t){return 1!==t?this.refmap:this.ownmap}}e.Observer=c;class f{constructor(t){this.fn=t,this.children=[],this._deps=new Set,this.is_run=!1}undepend(t){this._deps.delete(t),t.delete(this)}depend(t){this._deps.add(t),t.add(this)}release(){this._deps.forEach(t=>t.delete(this)),this._deps.clear();for(let t of this.children)t.release(),t.parent=void 0;this.children.length=0}unmount(){var t;this.release();let e=null===(t=this.parent)||void 0===t?void 0:t.children;e&&e.splice(e.indexOf(this),1),this.parent=void 0}mount(){return void 0!==this.parent?new f(this.fn).mount():(this.parent=r[0]||null,this.parent&&this.parent.children.push(this),this._run(),this)}update(){return this.release(),this._run()}addRecord(t){let e=a[0][0],n=i.indexOf(this);n<0||o[n][0]<e?(o.unshift([e,[t]]),i.unshift(this)):o[n][1].push(t)}_run(){this.is_run=!0,r.unshift(this);try{return this.fn()}catch(t){throw t}finally{r.shift(),this.is_run=!1}}}function h(t){return Array.prototype.concat.call(Object.getOwnPropertySymbols(t),Object.getOwnPropertyNames(t))}function d(t,e){!function(t){let e=a[0];t=void 0===t&&e?e[1]:!!t,a.unshift([t&&e?e[0]:a.length,t])}(e);try{return t()}catch(t){throw t}finally{!function(){let t=[],e=a.shift(),n=e[0];if(e[1]&&0!==a.length)return;for(;i.length;){let e=o[0];if(e[0]<n)break;let r=i[0];if(t.indexOf(r)<0){let n=new Map;for(let a of e[1]){let e,l=a[0],s=a[1],u=n.get(l);if(u){if(u.has(s))continue;u.add(s)}else n.set(l,new Set([s]));if(!g(1!==a[3]?l._val(s):l._has(s),a[2])){for(t.unshift(r);(e=i.lastIndexOf(r))>0;)i.splice(e,1),o.splice(e,1);break}}}i.shift(),o.shift()}_(t)}()}}function p(t){return d(t,!0)}function y(t){return t&&"object"==typeof t?new c(t).proxy:t}function b(t,e){let n=[],r=new f((function(){n.unshift(t()),n.length>1&&(e(n[0],n[1]),n.length=1)}));return r.mount(),function(){r.unmount()}}function _(t,e){let n=[];t:for(let e,r=0;r<t.length;r++){for(e=t[r];e=e.parent;)if(t.indexOf(e)>=0){t.splice(r--,1);continue t}e=t[r],e.is_run||n.push(t[r])}for(let t of n)e?t.addRecord(e):t.update()}function g(t,e){return t===e||t!=t&&e!=e}function v(t){let e=t.next.bind(t);return t.next=function(){let{done:t,value:n}=e();return t||(n=y(n)),{done:t,value:n}},t}e.Subscriber=f,e.atomic=function(t){return d.bind(null,t,!0)},e.runAtomic=p,e.action=function(t){return d.bind(null,t)},e.runAction=function(t){return d(t)},e.autorun=function(t){let e=new f(t);return e.mount(),function(){e.unmount()}},e.observable=y,e.computed=function(t){let e,n=0,r=new f((function(){(n^=1)&&(e=t())}));return function(){return n||r.update(),e}},e.watch=b,e.reaction=function(t,e){return b(t,(function(t,n){g(t,n)||e(t)}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0);let o=r.observable([{a:1},2,3]),i=r.observable({a:[1],b:2,c:3,[Symbol("test")]:4}),a=r.observable(new Set([1,2,3])),l=r.observable(new Map([["a",[1]],["b",2],["c",3]])),s=r.observable(new WeakSet),u=r.observable(new WeakMap),c=r.observable(new Float32Array(10));function f(t,...e){e.length&&e.unshift("->"),console.log(t,...e)}console.log(l),r.autorun(()=>{console.log(l.get("a")),r.autorun(()=>{console.log(l.keys());for(let t of l.keys())r.autorun(()=>{let e=l.get(t);console.log(t,e,e instanceof Array&&e[0])})})}),f("-------------",'map.get("a")[0] = 2'),l.get("a")[0]=2,f("-------------",'map.set("a", [3]);'),l.set("a",[3]),f("-------------",'map.set("b", [4]);'),l.set("b",[4]),f("-------------"),r.autorun(()=>{f("array[Symbol.iterator]().next().value",o[Symbol.iterator]().next())}),r.autorun(()=>{f(" array.indexOf(2)",o.indexOf(2))}),r.autorun(()=>{f("array.values()",o.values())}),r.autorun(()=>{f("array[0].a",o[0].a)}),r.autorun(()=>{f("array.length",o.length)}),o.unshift(o[0]),o.unshift({a:1.1}),r.runAtomic(()=>{r.runAction(()=>{o.unshift({a:0})}),o.shift()}),o[0].a=1.2,r.autorun(()=>{f("array[1], json.a[0]",o[1],i.a[0])}),r.autorun(()=>{f("array[3]",o[3])}),r.runAction(()=>{console.log("runInAction1","==========="),o[1]={a:1.3},r.runAction(()=>{console.log("runInAction2","==========="),o[1]={a:1.4},i.a[0]+=.1}),console.log("runInAction3","==========="),o[3]+=.1}),console.log("runInAction4","==========="),console.log("array","->",JSON.stringify(o)),f("------------------"),r.autorun(()=>{f("weakset.a",s.a)}),r.autorun(()=>{f('"a" in weakset',"a"in s)}),s.a=3,delete s.a,r.autorun(()=>{f("weakset.has(f32arr)",s.has(c))}),s.add(c),s.delete(c),r.autorun(()=>{f(u,u.get(c))}),u.set(c,33),u.delete(c),f(a[Symbol.toStringTag]),r.autorun(()=>{f(Object.keys(i))}),i.d=2,delete i.d,r.autorun(()=>{f('"2" in array',"2"in o)}),f("3333",i.d),r.autorun(()=>{f("set.size",a.size)}),r.autorun(()=>{f("set.has(2)",a.has(2))}),r.autorun(()=>{f("set.has(4)",a.has(4))}),a.add(4),a.delete(2),a.clear(),f("---------------------")}]);
//# sourceMappingURL=test.js.map